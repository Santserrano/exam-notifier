generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "windows"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Profesor {
  id           String         @id // clerk id
  nombre       String
  apellido     String
  email        String         @unique
  telefono     String?
  carreras     String[]
  materias     String[]
  mesasTitular MesaDeExamen[] @relation("ProfesorTitular")
  mesasVocal   MesaDeExamen[] @relation("ProfesorVocal")

  notificacionConfig   NotificacionConfig?
  webPushSubscriptions WebPushSubscription[]

  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
}


model MesaDeExamen {
  id          Int      @id @default(autoincrement())
  profesorId  String   // ID del profesor titular
  vocalId     String   // ID del profesor vocal
  profesor    Profesor @relation("ProfesorTitular", fields: [profesorId], references: [id])
  vocal       Profesor @relation("ProfesorVocal", fields: [vocalId], references: [id])
  carrera     String
  materia     String
  fecha       DateTime
  descripcion String
  cargo       String
  verification Boolean @default(false)
  modalidad   String?  @default("Presencial")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model NotificacionConfig {
  id               String    @id @default(uuid())
  profesorId       String   @unique
  profesor         Profesor @relation(fields: [profesorId], references: [id])
  webPushEnabled   Boolean  @default(false)
  emailEnabled     Boolean  @default(false)
  smsEnabled       Boolean  @default(false)
  avisoPrevioHoras Int      @default(24)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model WebPushSubscription {
  id           String    @id @default(uuid())
  profesorId   String
  profesor     Profesor  @relation(fields: [profesorId], references: [id])
  endpoint     String
  auth         String
  p256dh       String
  createdAt    DateTime  @default(now())
}
